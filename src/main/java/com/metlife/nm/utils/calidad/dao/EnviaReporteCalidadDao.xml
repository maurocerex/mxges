<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" "http://www.springframework.org/dtd/spring-beans-2.0.dtd">

<beans>
	<bean id="EnviaReporteCalidadDao" class="com.metlife.nm.utils.calidad.dao.EnviaReporteCalidadDaoImpl">
		<property name="dataSource" ref="dataSource"></property>
		
		
		<property name="qryDirectorio">
			<value>
				<![CDATA[
					SELECT  VALOR_PARAMETRO
					FROM    MXGES_CAT_PARAMETROS
					WHERE   CVE_PARAMETRO   =   'P_RUTA_REPORTES'
				]]>
			</value>
		</property>
		
		<property name="qryAgentes">
			<value>
				<![CDATA[
					SELECT DISTINCT CVE_APODERADO , NOTIF.CVE_PROMOTORIA            , NOTIF.EMAIL_APODERADO
								FROM MXGES_INFO_ENVIOS INFO, MXGES_ENVIO_NOTIFICACIONES NOTIF, MXGES_CAT_PROCESOS PROC
							WHERE INFO.ID_PROCESO = NOTIF.ID_PROCESO
					AND INFO.ID_REGISTRO    = NOTIF.ID_REGISTRO
					AND EXISTS
						(SELECT NULL
									FROM MXGES_V_METATABLAS1 MET
								WHERE MET.CVE_TABLA = 'CAT_ESTATUS_ENVIO'
						AND MET.CLAVE         = INFO.COL_04
						AND MET.VALOR_04      = 'S'
						)
					AND PROC.CVE_PROCESO =
						(SELECT CLAVE
									FROM MXGES_V_METATABLAS1 TAB1
								WHERE TAB1.CVE_TABLA = 'CAT_HOMOLOGAPROC'
						AND TAB1.VALOR_02      = NOTIF.CVE_PROCESO_ORIGEN
						)
					AND TO_CHAR(NOTIF.FEC_CREACION,'YYYYMM') = TO_CHAR(SYSDATE,'YYYYMM')
					AND NVL(PROC.SW_NOTIFICA_REPORTE,'0')    = '1'
					AND NOTIF.EMAIL_APODERADO               IS NOT NULL
				]]>
			</value>
		</property>
		<property name="qryPromotorias">
			<value>
				<![CDATA[
					SELECT DISTINCT NOTIF.CVE_PROMOTORIA, NOTIF.EMAIL_PROMOTORIA
								FROM MXGES_INFO_ENVIOS INFO      , MXGES_ENVIO_NOTIFICACIONES NOTIF, MXGES_CAT_PROCESOS PROC
							WHERE INFO.ID_PROCESO = NOTIF.ID_PROCESO
					AND INFO.ID_REGISTRO    = NOTIF.ID_REGISTRO
					AND EXISTS
						(SELECT NULL
									FROM MXGES_V_METATABLAS1 MET
								WHERE MET.CVE_TABLA = 'CAT_ESTATUS_ENVIO'
						AND MET.CLAVE         = INFO.COL_04
						AND MET.VALOR_04      = 'S'
						)
					AND PROC.CVE_PROCESO =
						(SELECT CLAVE
									FROM MXGES_V_METATABLAS1 TAB1
								WHERE TAB1.CVE_TABLA = 'CAT_HOMOLOGAPROC'
						AND TAB1.VALOR_02      = NOTIF.CVE_PROCESO_ORIGEN
						)
					AND TO_CHAR(NOTIF.FEC_CREACION,'YYYYMM') = TO_CHAR(SYSDATE,'YYYYMM')
					AND NVL(PROC.SW_NOTIFICA_REPORTE,'0')    = '1'
					AND NOTIF.EMAIL_PROMOTORIA              IS NOT NULL
				]]>
			</value>
		</property>
		<property name="qryRegistrosAgente">
			<value>
				<![CDATA[
						SELECT CVE_PROMOTORIA, NVL(NOTIF.ID_RETENEDOR_CT,9999) AS ID_RETENEDOR_CT, NVL(NOTIF.ID_UNIDAD_PAGO_CT,9999) AS ID_UNIDAD_PAGO_CT , ID_POLIZA ,
						NOTIF.NOMBRE_CLIENTE
						|| ' '
						|| NOTIF.APELLIDO_PATERNO_CLIENTE
						|| ' '
						|| NOTIF.APELLIDO_MATERNO_CLIENTE NOMBRE_CLIENTE , TEL_MOVIL_CLIENTE ,EMAIL_CLIENTE ,REF_BANCARIA ,
						CVE_APODERADO                                    , CONDUCTO_COBRO    ,
						(SELECT DESCRIPCION
									FROM MXGES_V_METATABLAS1 TAB1
								WHERE TAB1.CVE_TABLA = 'CAT_MEDIO_ENVIO'
						AND TAB1.CLAVE         = INFO.CVE_MEDIO_ENVIO
						) TIPOMENSAJE ,
						(SELECT CLAVE
									FROM MXGES_V_METATABLAS1 TAB1
								WHERE TAB1.CVE_TABLA = 'CAT_HOMOLOGAPROC'
						AND TAB1.VALOR_02      = NOTIF.CVE_PROCESO_ORIGEN
						) CVE_PROCESO                 , INFO.COL_04 CVE_ESTATUS         , MET.DESCRIPCION DETALLE , NOTIF.FEC_CREACION
								FROM MXGES_INFO_ENVIOS INFO , MXGES_ENVIO_NOTIFICACIONES NOTIF, MXGES_CAT_PROCESOS PROC , MXGES_V_METATABLAS1 MET
							WHERE INFO.ID_PROCESO = NOTIF.ID_PROCESO
					AND INFO.ID_REGISTRO    = NOTIF.ID_REGISTRO
					AND PROC.CVE_PROCESO    =
						(SELECT CLAVE
									FROM MXGES_V_METATABLAS1 TAB1
								WHERE TAB1.CVE_TABLA = 'CAT_HOMOLOGAPROC'
						AND TAB1.VALOR_02      = NOTIF.CVE_PROCESO_ORIGEN
						)
					AND TO_CHAR(NOTIF.FEC_CREACION,'YYYYMM') = TO_CHAR(SYSDATE,'YYYYMM')
					AND NVL(PROC.SW_NOTIFICA_REPORTE,'0')    = '1'
					AND CVE_APODERADO                        = ?
					AND CVE_PROMOTORIA                       = ?
					AND MET.CVE_TABLA                        = 'CAT_ESTATUS_ENVIO'
					AND MET.CLAVE                            = INFO.COL_04
					AND MET.VALOR_04                         = 'S'
					AND NOTIF.EMAIL_APODERADO               IS NOT NULL 
				]]>
			</value>
		</property>
		<property name="qryRegistrosPromotor">
			<value>
				<![CDATA[
						SELECT NOTIF.CVE_PROMOTORIA , NVL(NOTIF.ID_RETENEDOR_CT,9999) AS ID_RETENEDOR_CT , NVL(NOTIF.ID_UNIDAD_PAGO_CT,9999) AS ID_UNIDAD_PAGO_CT , ID_POLIZA ,
						NOTIF.NOMBRE_CLIENTE
						|| ' '
						|| NOTIF.APELLIDO_PATERNO_CLIENTE
						|| ' '
						|| NOTIF.APELLIDO_MATERNO_CLIENTE NOMBRE_CLIENTE ,TEL_MOVIL_CLIENTE ,EMAIL_CLIENTE ,REF_BANCARIA ,
						CVE_APODERADO                                    , CONDUCTO_COBRO   ,
						(SELECT DESCRIPCION
									FROM MXGES_V_METATABLAS1 TAB1
								WHERE TAB1.CVE_TABLA = 'CAT_MEDIO_ENVIO'
						AND TAB1.CLAVE         = INFO.CVE_MEDIO_ENVIO
						) TIPOMENSAJE ,
						(SELECT CLAVE
									FROM MXGES_V_METATABLAS1 TAB1
								WHERE TAB1 . CVE_TABLA = 'CAT_HOMOLOGAPROC'
						AND TAB1 . VALOR_02      = NOTIF . CVE_PROCESO_ORIGEN
						) CVE_PROCESO                , INFO.COL_04 CVE_ESTATUS          , MET.DESCRIPCION DETALLE , NOTIF.FEC_CREACION
								FROM MXGES_INFO_ENVIOS INFO, MXGES_ENVIO_NOTIFICACIONES NOTIF , MXGES_CAT_PROCESOS PROC , MXGES_V_METATABLAS1 MET
							WHERE INFO.ID_PROCESO = NOTIF.ID_PROCESO
					AND INFO.ID_REGISTRO    = NOTIF.ID_REGISTRO
					AND PROC.CVE_PROCESO    =
						(SELECT CLAVE
									FROM MXGES_V_METATABLAS1 TAB1
								WHERE TAB1.CVE_TABLA = 'CAT_HOMOLOGAPROC'
						AND TAB1.VALOR_02      = NOTIF.CVE_PROCESO_ORIGEN
						)
					AND TO_CHAR(NOTIF.FEC_CREACION,'YYYYMM') = TO_CHAR(SYSDATE,'YYYYMM')
					AND NVL(PROC.SW_NOTIFICA_REPORTE,'0')    = '1'
					AND NOTIF.CVE_PROMOTORIA                 = ?
					AND MET.CVE_TABLA                        = 'CAT_ESTATUS_ENVIO'
					AND MET.CLAVE                            = INFO.COL_04
					AND MET.VALOR_04                         = 'S'
					AND NOTIF.EMAIL_PROMOTORIA              IS NOT NULL 
				]]>
			</value>
		</property>
		
	</bean>
</beans>
	